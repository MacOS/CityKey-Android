def getSecretProperties() {
    Properties props = new Properties()
    if (file('../secrets.properties').exists()) {
        props.load(new FileInputStream(file('../secrets.properties')))
    }
    return props
}

String getSecret(prop) {
    if (runningOnGitlab) return System.getenv(prop)
    return secretProperties[prop]
}

String getSonarqubeToken() {
    if (runningOnGitlab) return System.getenv('SONARQUBE_TOKEN')
    Properties props = new Properties()
    if (file('secrets.properties').exists()) {
        props.load(new FileInputStream(file('secrets.properties')))
    }
    String value = props['SONARQUBE_TOKEN']
    return value
}

ext {
    secretProperties = this.&getSecretProperties
    getSecret = this.&getSecret
    getSonarqubeToken = this.&getSonarqubeToken
}
